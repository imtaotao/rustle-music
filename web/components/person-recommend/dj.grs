<template>
  <div styleName='dj-container'>
    <div styleName='title'>主播电台<i></i></div>
    <div styleName='content'>
      <ul>
        <li v-for='item of data'>
          <div styleName='img' :style='{backgroundImage: "url(" + item.song.album.picUrl + ")"}'></div>
          <div styleName='desc'>
            <div styleName='name'>{{ item.name }}</div>
            <div styleName='auth'>
              <span v-for='(val, i) of item.song.artists'>
                <a v-if='i !== 0'> / </a>
                {{ val.name }}
              </span>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>
</template>

<script>
  import userManager from 'web/manager/user'

  @Grass.CSSModules(style)
  export default class DJ extends Grass.Component {
    // #temp
    willReceiveProps = () => false

    beforeCreate () {
      const item = {
        name: '-', 
        song: {
          album: {picUrl: ''},
          artists: [{name: '-'}],
        },
      }
      this.state = {
        data: [item, item, item, item],
      }
      this.getDJData()
      userManager.on('login', this.getDJData)
      userManager.on('logout', this.getDJData)
    }

    getDJData = () => {
      window.node.request('/personalized/newsong').then(({body}) => {
        let data = body.result || []
        this.setState({data})
        console.log(data);
      }, this.props.efn)
    }
  }
</script>